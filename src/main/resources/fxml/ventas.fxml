<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<VBox xmlns="http://javafx.com/javafx"
      xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.arielcardales.arielcardales.controller.VentasController"
      spacing="15"
      style="-fx-background-color: #E8DCC4; -fx-padding: 20;">

    <!-- ENCABEZADO -->
    <HBox alignment="CENTER_LEFT" spacing="15">
        <Label text="ðŸ’° GestiÃ³n de Ventas" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #5D4E37;">
            <font>
                <Font name="System Bold" size="24.0"/>
            </font>
        </Label>

        <Region HBox.hgrow="ALWAYS"/>

        <!-- â­ NUEVO: Toggle de Productos MÃ¡s Vendidos -->
        <ToggleButton fx:id="btnMasVendidos"
                      text="ðŸ“Š MÃ¡s Vendidos"
                      onAction="#toggleMasVendidos"
                      style="-fx-background-color: #8B7355; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 10 20; -fx-cursor: hand;">
            <font>
                <Font size="13.0"/>
            </font>
        </ToggleButton>

        <Button fx:id="btnNuevaVenta"
                text="+ Nueva Venta"
                onAction="#abrirNuevaVenta"
                style="-fx-background-color: #D4A574; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 10 20;">
            <font>
                <Font size="13.0"/>
            </font>
        </Button>
    </HBox>

    <!-- FILTROS -->
    <VBox spacing="10" style="-fx-background-color: #D4A574; -fx-padding: 15; -fx-background-radius: 8;">
        <Label text="Filtros:" style="-fx-font-weight: bold; -fx-text-fill: #5D4E37;"/>

        <HBox spacing="15" alignment="CENTER_LEFT">
            <Label text="Buscar cliente:" style="-fx-text-fill: #5D4E37;"/>
            <TextField fx:id="txtBuscarCliente"
                       promptText="Buscar por cliente..."
                       prefWidth="200"/>

            <Region HBox.hgrow="ALWAYS"/>

            <Label text="Desde:" style="-fx-text-fill: #5D4E37;"/>
            <DatePicker fx:id="dpFechaInicio" prefWidth="140"/>

            <Label text="Hasta:" style="-fx-text-fill: #5D4E37;"/>
            <DatePicker fx:id="dpFechaFin" prefWidth="140"/>

            <Button fx:id="btnFiltrar"
                    text="Filtrar"
                    onAction="#filtrarPorFechas"
                    style="-fx-background-color: #8B7355; -fx-text-fill: white; -fx-padding: 8 20;"/>

            <Button fx:id="btnLimpiar"
                    text="Limpiar"
                    onAction="#limpiarFiltros"
                    style="-fx-background-color: #A67C52; -fx-text-fill: white; -fx-padding: 8 20;"/>
        </HBox>
    </VBox>

    <!-- ESTADÃSTICAS -->
    <HBox spacing="10">
        <VBox alignment="CENTER" spacing="5"
              style="-fx-background-color: #D4A574; -fx-padding: 15; -fx-background-radius: 8;"
              HBox.hgrow="ALWAYS">
            <Label text="Total Ventas" style="-fx-font-size: 12px; -fx-text-fill: #5D4E37;"/>
            <Label fx:id="lblTotalVentas" text="0" style="-fx-font-size: 20px; -fx-font-weight: bold;"/>
        </VBox>

        <VBox alignment="CENTER" spacing="5"
              style="-fx-background-color: #D4A574; -fx-padding: 15; -fx-background-radius: 8;"
              HBox.hgrow="ALWAYS">
            <Label text="Monto Total" style="-fx-font-size: 12px; -fx-text-fill: #5D4E37;"/>
            <Label fx:id="lblTotalMonto" text=" 0,00" style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: green;"/>
        </VBox>

        <VBox alignment="CENTER" spacing="5"
              style="-fx-background-color: #D4A574; -fx-padding: 15; -fx-background-radius: 8;"
              HBox.hgrow="ALWAYS">
            <Label text="Promedio" style="-fx-font-size: 12px; -fx-text-fill: #5D4E37;"/>
            <Label fx:id="lblPromedioVenta" text=" 0,00" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
        </VBox>

        <VBox alignment="CENTER" spacing="5"
              style="-fx-background-color: #D4A574; -fx-padding: 15; -fx-background-radius: 8;"
              HBox.hgrow="ALWAYS">
            <Label text="Mayor" style="-fx-font-size: 12px; -fx-text-fill: #5D4E37;"/>
            <Label fx:id="lblVentaMayor" text=" 0,00" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
        </VBox>

        <VBox alignment="CENTER" spacing="5"
              style="-fx-background-color: #D4A574; -fx-padding: 15; -fx-background-radius: 8;"
              HBox.hgrow="ALWAYS">
            <Label text="Menor" style="-fx-font-size: 12px; -fx-text-fill: #5D4E37;"/>
            <Label fx:id="lblVentaMenor" text=" 0,00" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
        </VBox>
    </HBox>

    <!-- â­ CONTENEDOR PRINCIPAL CON TABLA + PANEL LATERAL -->
    <StackPane fx:id="contenedorPrincipal" VBox.vgrow="ALWAYS">

        <!-- TABLA DE VENTAS (siempre visible) -->
        <VBox spacing="10" style="-fx-background-color: transparent;">
            <Label text="Listado de Ventas"
                   style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #5D4E37;"/>

            <StackPane VBox.vgrow="ALWAYS">
                <TableView fx:id="tablaVentas"
                           style="-fx-background-color: #f5e5d0;">
                </TableView>

                <!-- Spinner de carga sobre la tabla -->
                <VBox fx:id="vboxLoading"
                      alignment="CENTER"
                      spacing="10"
                      visible="false"
                      managed="false"
                      style="-fx-background-color: rgba(229, 203, 161, 0.85);">
                    <ProgressIndicator fx:id="progressIndicator"
                                       style="-fx-progress-color: #b88a52;"
                                       prefWidth="60"
                                       prefHeight="60"/>
                    <Label text="Cargando ventas..."
                           style="-fx-text-fill: #2b2b2b; -fx-font-size: 14px; -fx-font-weight: bold;"/>
                </VBox>
            </StackPane>
        </VBox>

        <!-- â­ PANEL LATERAL DESLIZANTE (Productos MÃ¡s Vendidos) -->
        <VBox fx:id="panelLateralMasVendidos"
              spacing="10"
              maxWidth="320"
              prefWidth="320"
              style="-fx-background-color: #e5cba1; -fx-padding: 15; -fx-background-radius: 8; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.3), 10, 0, -3, 0); -fx-border-color: #cfa971; -fx-border-width: 0 0 0 2;"
              StackPane.alignment="CENTER_RIGHT">

            <!-- Header del panel -->
            <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-padding: 5 0 10 0;">
                <Label text="ðŸ“Š Top 10 Productos"
                       style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: #2b2b2b;">
                    <font>
                        <Font name="Lora Bold" size="15.0"/>
                    </font>
                </Label>

                <Region HBox.hgrow="ALWAYS"/>

                <Button text="âœ•"
                        onAction="#toggleMasVendidos"
                        style="-fx-background-color: transparent; -fx-text-fill: #2b2b2b; -fx-font-size: 18px; -fx-font-weight: bold; -fx-cursor: hand; -fx-padding: 5;"/>
            </HBox>

            <Separator style="-fx-background-color: #cfa971;"/>

            <!-- Info contextual -->
            <Label text="ðŸ’¡ Haz clic en un producto para ver sus ventas"
                   style="-fx-font-size: 11px; -fx-text-fill: #2b2b2b; -fx-font-style: italic;"
                   wrapText="true"/>

            <!-- Tabla de productos mÃ¡s vendidos -->
            <TableView fx:id="tablaMasVendidos"
                       VBox.vgrow="ALWAYS"
                       style="-fx-background-color: #f5e5d0;">
            </TableView>

            <Separator style="-fx-background-color: #cfa971;"/>

            <!-- Footer con leyenda -->
            <HBox alignment="CENTER" spacing="5">
                <Label text="ðŸ“ˆ" style="-fx-font-size: 16px;"/>
                <Label fx:id="lblPeriodoPanel" text="PerÃ­odo seleccionado"
                       style="-fx-font-size: 10px; -fx-text-fill: #2b2b2b;"/>
            </HBox>
        </VBox>
    </StackPane>

</VBox>